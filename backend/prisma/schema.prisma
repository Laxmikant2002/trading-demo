// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum TradeSide {
  BUY
  SELL
}

enum TradeStatus {
  OPEN
  CLOSED
}

enum OrderType {
  MARKET
  LIMIT
  STOP
  TAKE_PROFIT
}

enum OrderStatus {
  PENDING
  FILLED
  CANCELLED
}

enum OrderSide {
  BUY
  SELL
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  password     String?
  googleId     String?  @unique
  demoBalance  Float    @default(10000)
  marginLevel  Float?
  lastReset    DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  trades Trade[]
  orders Order[]

  @@map("users")
}

model Trade {
  id         String      @id @default(uuid())
  userId     String
  symbol     String
  side       TradeSide
  quantity   Float
  entryPrice Float
  exitPrice  Float?
  pnl        Float?
  status     TradeStatus @default(OPEN)
  openedAt   DateTime    @default(now())
  closedAt   DateTime?
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("trades")
}

model Order {
  id         String      @id @default(uuid())
  userId     String
  type       OrderType
  status     OrderStatus @default(PENDING)
  symbol     String
  side       OrderSide
  quantity   Float
  price      Float?
  stopLoss   Float?
  takeProfit Float?
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  filledAt   DateTime?

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("orders")
}